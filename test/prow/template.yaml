apiVersion: template.openshift.io/v1
kind: Template
metadata:
  name: assisted-chat-eval-test
objects:
- apiVersion: apps/v1
  kind: Deployment
  metadata:
    name:assisted-chat-eval-test
  spec:
    selector:
      matchLabels:
        app: assisted-chat-eval-test
    replicas: 1
    template:
      metadata:
        labels:
          app: assisted-chat-eval-test
      spec:
        restartPolicy: Always
        containers:
          - name: assisted-chat-eval-test
            image: ${IMAGE_NAME}
            imagePullPolicy: Always
            env:
            - name: CLIENT_ID
              valueFrom:
                secretKeyRef:
                  key: ${SSL_CLIENT_ID}
                  name: ${SSL_CLIENT_SECRET_NAME}
            - name: CLIENT_SECRET
              valueFrom:
                secretKeyRef:
                  key: ${SSL_CLIENT_SECRET_KEY}
                  name: ${SSL_CLIENT_SECRET_NAME}
            - name: GEMINI_API_KEY
              valueFrom:
                secretKeyRef:
                  key: ${GEMINI_API_SECRET_KEY_NAME}
                  name: ${GEMINI_API_SECRET_NAME}
            - name: AGENT_URL
              value: ${AGENT_URL}
            - name: AGENT_PORT
              value: ${AGENT_PORT}

        
- apiVersion: v1
  kind: Service
  metadata:
    labels:
      app: assisted-chat-eval-test
    name: assisted-chat-eval-test
  spec:
    ports:
    - port: 8091
      protocol: TCP
      targetPort: 8091
    selector:
      app: assisted-chat-eval-test
    sessionAffinity: None
    type: ClusterIP

parameters:
- name: IMAGE_NAME
  required: true
- name: SSL_CLIENT_SECRET_NAME
  value: assisted-chat-ssl-ci
- name: SSL_CLIENT_ID
  value: client_id
- name: SSL_CLIENT_SECRET_KEY
  value: client_secret
- name: AGENT_URL
  value: http://assisted-chat
- name: AGENT_PORT
  value: "8090"
- name: GEMINI_API_SECRET_NAME
  value: gemini
- name: GEMINI_API_SECRET_KEY_NAME
  value: api_key

